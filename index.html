<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页数据分析看板</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        .dashboard-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #34495e;
            margin: 30px 0 15px 0;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        .card-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .metric-title {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        .metric-subtitle {
            font-size: 12px;
            color: #95a5a6;
            margin-bottom: 15px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .metric-comparison {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        .comparison-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .positive {
            color: #27ae60;
        }
        .negative {
            color: #e74c3c;
        }
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .full-width {
            width: 100%;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        .chart-subtitle {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
        }
        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .filter-group label {
            font-size: 14px;
            color: #7f8c8d;
        }
        .filter-group select,
        .filter-group input[type="date"] {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        canvas {
            max-height: 350px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: #ecf0f1;
            padding: 12px;
            text-align: left;
            font-size: 14px;
            color: #2c3e50;
            border-bottom: 2px solid #bdc3c7;
        }
        td {
            padding: 12px;
            font-size: 14px;
            color: #34495e;
            border-bottom: 1px solid #ecf0f1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .chart-wrapper {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="dashboard-title">首页数据分析看板</div>
    
    <!-- 模块1: 首页核心指标 -->
    <div class="section-title">首页核心指标</div>
    <div style="display:flex; justify-content:flex-end; padding:10px 0;">
        <div class="filter-group">
            <label>日期：</label>
            <input type="date" id="coreStartDate" onchange="updateCoreMetrics()" />
            <span>—</span>
            <input type="date" id="coreEndDate" onchange="updateCoreMetrics()" />
        </div>
    </div>
    <div class="card-container">
        <div class="metric-card">
            <div class="metric-title">首页访问总量（PV）</div>
            <div class="metric-subtitle">home_page_view 事件累计总数</div>
            <div class="metric-value" id="corePV">42,356</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +15.3%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +8.2%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">用户数（UV）</div>
            <div class="metric-subtitle">访问首页的不重复用户数</div>
            <div class="metric-value" id="coreUV">28,543</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +12.8%</span>
                </div>
                <div class="comparison-item negative">
                    <span>↓</span>
                    <span>环比 -2.5%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">人均访问首页数</div>
            <div class="metric-subtitle">首页访问总量 / 用户数</div>
            <div class="metric-value" id="coreAvg">1.48</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +2.2%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +10.8%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">首页跳出率</div>
            <div class="metric-subtitle">只访问首页的用户数 / 总UV</div>
            <div class="metric-value" id="coreBounce">32.5%</div>
            <div class="metric-comparison">
                <div class="comparison-item negative">
                    <span>↑</span>
                    <span>同比 +3.1%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↓</span>
                    <span>环比 -1.8%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 模块2: 首页数据分析 -->
    <div class="section-title">首页数据分析</div>
    
    <!-- 2-1 流量趋势 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">流量趋势</div>
                <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
            </div>
            <div class="filter-group">
                <label>指标：</label>
                <select id="trendMetricSelect" onchange="updateTrendChart()">
                    <option value="pv">首页访问总量（PV）</option>
                    <option value="uv">用户数（UV）</option>
                    <option value="avg">人均访问首页数</option>
                    <option value="bounce">首页跳出率</option>
                </select>
                <label>对比：</label>
                <select id="trendCompareSelect" onchange="updateTrendChart()">
                    <option value="yoy">同比</option>
                    <option value="mom">环比</option>
                </select>
                <label>日期：</label>
                <input type="date" id="trendStartDate" onchange="updateTrendChart()" />
                <span>—</span>
                <input type="date" id="trendEndDate" onchange="updateTrendChart()" />
            </div>
        </div>
        <canvas id="trendChart"></canvas>
    </div>
    
    <!-- 2-2 用户构成 -->
    <div class="card-container">
        <div class="metric-card">
            <div class="metric-title">登录用户数占比</div>
            <div class="metric-subtitle">登录用户总数（去重）/ 总UV（去重）</div>
            <div class="metric-value">68.2%</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +5.6%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +2.3%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">游客数占比</div>
            <div class="metric-subtitle">未登录用户总数（去重）/ 总UV（去重）</div>
            <div class="metric-value">31.8%</div>
            <div class="metric-comparison">
                <div class="comparison-item negative">
                    <span>↓</span>
                    <span>同比 -5.6%</span>
                </div>
                <div class="comparison-item negative">
                    <span>↓</span>
                    <span>环比 -2.3%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">平均停留时长</div>
            <div class="metric-subtitle">用户在首页的平均停留时间（秒）</div>
            <div class="metric-value">156秒</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +18.5%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +6.8%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 模块3: 首页Banner分析 -->
    <div class="section-title">首页Banner分析</div>
    
    <!-- 3-1 Banner明细数据 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">Banner明细数据</div>
                <div class="chart-subtitle">各Banner详细指标数据</div>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Banner标题</th>
                        <th style="text-align: center;">上架天数</th>
                        <th style="text-align: center;">上架时间</th>
                        <th style="text-align: center;">上架栏位</th>
                        <th style="text-align: right;">点击量</th>
                        <th style="text-align: right;">点击率</th>
                        <th style="text-align: right;">日均点击量</th>
                        <th style="text-align: right;">日均点击率</th>
                        <th style="text-align: right;">环比变化</th>
                    </tr>
                </thead>
                <tbody id="bannerTableBody">
                    <tr>
                        <td style="font-weight: 500;">AI大模型应用实战</td>
                        <td style="text-align: center;">28天</td>
                        <td style="text-align: center;">2024-10-03</td>
                        <td style="text-align: center;">位置1</td>
                        <td style="text-align: right; font-weight: 500;">45,230</td>
                        <td style="text-align: right;">3.63%</td>
                        <td style="text-align: right;">1,615</td>
                        <td style="text-align: right;">0.13%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 8.5%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">云计算架构设计</td>
                        <td style="text-align: center;">25天</td>
                        <td style="text-align: center;">2024-10-06</td>
                        <td style="text-align: center;">位置2</td>
                        <td style="text-align: right; font-weight: 500;">38,950</td>
                        <td style="text-align: right;">3.13%</td>
                        <td style="text-align: right;">1,558</td>
                        <td style="text-align: right;">0.13%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 2.3%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">Python数据分析</td>
                        <td style="text-align: center;">30天</td>
                        <td style="text-align: center;">2024-10-01</td>
                        <td style="text-align: center;">位置3</td>
                        <td style="text-align: right; font-weight: 500;">32,180</td>
                        <td style="text-align: right;">2.58%</td>
                        <td style="text-align: right;">1,073</td>
                        <td style="text-align: right;">0.09%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 12.7%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">Docker容器化技术</td>
                        <td style="text-align: center;">22天</td>
                        <td style="text-align: center;">2024-10-09</td>
                        <td style="text-align: center;">位置4</td>
                        <td style="text-align: right; font-weight: 500;">28,760</td>
                        <td style="text-align: right;">2.31%</td>
                        <td style="text-align: right;">1,307</td>
                        <td style="text-align: right;">0.10%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 5.8%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">前端框架Vue3实战</td>
                        <td style="text-align: center;">18天</td>
                        <td style="text-align: center;">2024-10-13</td>
                        <td style="text-align: center;">位置1</td>
                        <td style="text-align: right; font-weight: 500;">24,390</td>
                        <td style="text-align: right;">1.96%</td>
                        <td style="text-align: right;">1,355</td>
                        <td style="text-align: right;">0.11%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 15.2%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">Kubernetes实战</td>
                        <td style="text-align: center;">15天</td>
                        <td style="text-align: center;">2024-10-16</td>
                        <td style="text-align: center;">位置2</td>
                        <td style="text-align: right; font-weight: 500;">19,820</td>
                        <td style="text-align: right;">1.59%</td>
                        <td style="text-align: right;">1,321</td>
                        <td style="text-align: right;">0.11%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 3.9%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 3-2 各Banner点击量分布 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">各Banner点击量分布趋势</div>
                <div class="chart-subtitle">折线图：展示各Banner随时间变化的趋势</div>
            </div>
            <div class="filter-group">
                <label>指标：</label>
                <select id="bannerMetricSelect" onchange="updateBannerChart()">
                    <option value="clicks">点击量</option>
                    <option value="ctr">点击率(%)</option>
                    <option value="avgClicks">日均点击量</option>
                    <option value="avgCtr">日均点击率(%)</option>
                </select>
                <label>日期：</label>
                <input type="date" id="bannerStartDate" onchange="updateBannerChart()" />
                <span>—</span>
                <input type="date" id="bannerEndDate" onchange="updateBannerChart()" />
            </div>
        </div>
        <canvas id="bannerChart"></canvas>
    </div>
    
    <!-- 模块4: 首页在线课程分析 -->
    <div class="section-title">首页在线课程分析</div>
    
    <!-- 4-1 在线课程基本数据 - 四张卡片 -->
    <div class="card-container">
        <div class="metric-card">
            <div class="metric-title">查看全部点击量</div>
            <div class="metric-subtitle">home_view_all_to_online_course_click 事件总数</div>
            <div class="metric-value">2,845</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +18.5%</span>
                </div>
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +6.8%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">查看全部转化率</div>
            <div class="metric-subtitle">查看全部点击量 / PV</div>
            <div class="metric-value">6.72%</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>同比 +2.8%</span>
                </div>
                <div class="comparison-item negative">
                    <span>↓</span>
                    <span>环比 -1.2%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">运营位课程点击量</div>
            <div class="metric-subtitle">home_online_course_card_click 事件总数</div>
            <div class="metric-value">4,152</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +12.3%</span>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-title">运营位课程点击率</div>
            <div class="metric-subtitle">运营位课程点击量 / PV</div>
            <div class="metric-value">9.80%</div>
            <div class="metric-comparison">
                <div class="comparison-item positive">
                    <span>↑</span>
                    <span>环比 +3.9%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 4-1 在线课程趋势图 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">在线课程数据趋势</div>
                <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
            </div>
            <div class="filter-group">
                <label>指标类型：</label>
                <select id="courseTypeSelect" onchange="updateCourseTrendChart()">
                    <option value="viewAll">查看全部</option>
                    <option value="operation">运营位课程</option>
                </select>
                <label>数据维度：</label>
                <select id="courseDataSelect" onchange="updateCourseTrendChart()">
                    <option value="clicks">点击量</option>
                    <option value="rate">点击率(%)</option>
                </select>
                <label>对比：</label>
                <select id="courseCompareSelect" onchange="updateCourseTrendChart()">
                    <option value="yoy">同比</option>
                    <option value="mom">环比</option>
                </select>
                <label>日期：</label>
                <input type="date" id="courseStartDate" onchange="updateCourseTrendChart()" />
                <span>—</span>
                <input type="date" id="courseEndDate" onchange="updateCourseTrendChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="courseTrendChart"></canvas>
        </div>
    </div>
    
    <!-- 4-2 Tab交互分析 -->
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div class="chart-container" style="flex: 1; max-width: 33.33%;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">各Tab点击量分布</div>
                    <div class="chart-subtitle">不同Tab的点击量占比</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="courseTabPieChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container" style="flex: 2;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">各Tab点击量分布趋势</div>
                    <div class="chart-subtitle">各Tab每日点击量占比变化（堆积100%）</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="courseTabStackChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- 4-3 课程推荐效果分析 - 明细表格 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">推荐课程明细数据</div>
                <div class="chart-subtitle">各推荐课程详细指标数据</div>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>课程名称</th>
                        <th style="text-align: center;">上架天数</th>
                        <th style="text-align: center;">上架时间</th>
                        <th style="text-align: right;">点击量</th>
                        <th style="text-align: right;">点击率</th>
                        <th style="text-align: right;">日均点击量</th>
                        <th style="text-align: right;">日均点击率</th>
                        <th style="text-align: right;">环比变化</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="font-weight: 500;">Python数据分析实战</td>
                        <td style="text-align: center;">28天</td>
                        <td style="text-align: center;">2024-10-03</td>
                        <td style="text-align: right; font-weight: 500;">35,680</td>
                        <td style="text-align: right;">2.86%</td>
                        <td style="text-align: right;">1,274</td>
                        <td style="text-align: right;">0.10%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 15.2%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">AI大模型应用开发</td>
                        <td style="text-align: center;">25天</td>
                        <td style="text-align: center;">2024-10-06</td>
                        <td style="text-align: right; font-weight: 500;">32,450</td>
                        <td style="text-align: right;">2.60%</td>
                        <td style="text-align: right;">1,298</td>
                        <td style="text-align: right;">0.10%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 22.8%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">云计算架构设计</td>
                        <td style="text-align: center;">30天</td>
                        <td style="text-align: center;">2024-10-01</td>
                        <td style="text-align: right; font-weight: 500;">28,930</td>
                        <td style="text-align: right;">2.32%</td>
                        <td style="text-align: right;">964</td>
                        <td style="text-align: right;">0.08%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 3.5%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">前端框架Vue3实战</td>
                        <td style="text-align: center;">22天</td>
                        <td style="text-align: center;">2024-10-09</td>
                        <td style="text-align: right; font-weight: 500;">26,780</td>
                        <td style="text-align: right;">2.15%</td>
                        <td style="text-align: right;">1,217</td>
                        <td style="text-align: right;">0.10%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 8.9%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">MySQL性能优化</td>
                        <td style="text-align: center;">27天</td>
                        <td style="text-align: center;">2024-10-04</td>
                        <td style="text-align: right; font-weight: 500;">24,560</td>
                        <td style="text-align: right;">1.97%</td>
                        <td style="text-align: right;">910</td>
                        <td style="text-align: right;">0.07%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 12.3%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">Docker容器化技术</td>
                        <td style="text-align: center;">18天</td>
                        <td style="text-align: center;">2024-10-13</td>
                        <td style="text-align: right; font-weight: 500;">21,890</td>
                        <td style="text-align: right;">1.76%</td>
                        <td style="text-align: right;">1,216</td>
                        <td style="text-align: right;">0.10%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 6.2%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">React Native移动开发</td>
                        <td style="text-align: center;">20天</td>
                        <td style="text-align: center;">2024-10-11</td>
                        <td style="text-align: right; font-weight: 500;">19,340</td>
                        <td style="text-align: right;">1.55%</td>
                        <td style="text-align: right;">967</td>
                        <td style="text-align: right;">0.08%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 18.7%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">Kubernetes实战指南</td>
                        <td style="text-align: center;">15天</td>
                        <td style="text-align: center;">2024-10-16</td>
                        <td style="text-align: right; font-weight: 500;">17,620</td>
                        <td style="text-align: right;">1.41%</td>
                        <td style="text-align: right;">1,175</td>
                        <td style="text-align: right;">0.09%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 5.4%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 4-3 推荐课程点击量分布趋势 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">推荐课程点击量分布趋势</div>
                <div class="chart-subtitle">折线图：展示各课程随时间变化的趋势</div>
            </div>
            <div class="filter-group">
                <label>指标：</label>
                <select id="courseMetricSelect" onchange="updateCourseChart()">
                    <option value="clicks">点击量</option>
                    <option value="ctr">点击率(%)</option>
                    <option value="avgClicks">日均点击量</option>
                    <option value="avgCtr">日均点击率(%)</option>
                </select>
                <label>排序：</label>
                <select id="courseSortSelect" onchange="updateCourseChart()">
                    <option value="desc">降序</option>
                    <option value="asc">升序</option>
                </select>
                <label>日期：</label>
                <input type="date" id="courseChartStartDate" onchange="updateCourseChart()" />
                <span>—</span>
                <input type="date" id="courseChartEndDate" onchange="updateCourseChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="courseChart"></canvas>
        </div>
    </div>
    
    <!-- 模块5: 首页动手实验分析 -->
    <div class="section-title">首页动手实验分析</div>
    
    <!-- 5-1 动手实验基本数据 -->
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="flex: 1; max-width: 33.33%; display: flex; flex-direction: column; gap: 20px;">
            <div class="metric-card" style="margin: 0;">
                <div class="metric-title">查看全部点击量</div>
                <div class="metric-subtitle">home_view_all_to_tencent_cloud_lab_click 事件总数</div>
                <div class="metric-value">1,762</div>
                <div class="metric-comparison">
                    <div class="comparison-item positive">
                        <span>↑</span>
                        <span>同比 +24.3%</span>
                    </div>
                    <div class="comparison-item positive">
                        <span>↑</span>
                        <span>环比 +9.7%</span>
                    </div>
                </div>
            </div>
            
            <div class="metric-card" style="margin: 0;">
                <div class="metric-title">查看全部转化率</div>
                <div class="metric-subtitle">查看全部点击量 / PV</div>
                <div class="metric-value">4.16%</div>
                <div class="metric-comparison">
                    <div class="comparison-item positive">
                        <span>↑</span>
                        <span>同比 +3.5%</span>
                    </div>
                    <div class="comparison-item negative">
                        <span>↓</span>
                        <span>环比 -0.8%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-container" style="flex: 2; margin: 0;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">动手实验数据趋势</div>
                    <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
                </div>
                <div class="filter-group">
                    <label>数据维度：</label>
                    <select id="labDataSelect" onchange="updateLabTrendChart()">
                        <option value="clicks">点击量</option>
                        <option value="rate">转化率(%)</option>
                    </select>
                    <label>对比：</label>
                    <select id="labCompareSelect" onchange="updateLabTrendChart()">
                        <option value="yoy">同比</option>
                        <option value="mom">环比</option>
                    </select>
                    <label>日期：</label>
                    <input type="date" id="labStartDate" onchange="updateLabTrendChart()" />
                    <span>—</span>
                    <input type="date" id="labEndDate" onchange="updateLabTrendChart()" />
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="labTrendChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- 5-2 实验Tab交互分析 -->
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div class="chart-container" style="flex: 1; max-width: 33.33%;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">实验类型点击量分布</div>
                    <div class="chart-subtitle">不同实验类型的点击量占比</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="labTabPieChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container" style="flex: 2;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">实验类型点击量分布趋势</div>
                    <div class="chart-subtitle">各实验类型每日点击量占比变化（堆积100%）</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="labTabStackChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- 5-3 实验推荐效果分析 - 明细表格 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">推荐实验明细数据</div>
                <div class="chart-subtitle">各推荐实验详细指标数据</div>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>实验名称</th>
                        <th style="text-align: center;">上架天数</th>
                        <th style="text-align: center;">上架时间</th>
                        <th style="text-align: right;">点击量</th>
                        <th style="text-align: right;">点击率</th>
                        <th style="text-align: right;">日均点击量</th>
                        <th style="text-align: right;">日均点击率</th>
                        <th style="text-align: right;">环比变化</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="font-weight: 500;">搭建个人博客网站</td>
                        <td style="text-align: center;">30天</td>
                        <td style="text-align: center;">2024-10-01</td>
                        <td style="text-align: right; font-weight: 500;">18,560</td>
                        <td style="text-align: right;">1.49%</td>
                        <td style="text-align: right;">619</td>
                        <td style="text-align: right;">0.05%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 18.6%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">云数据库部署实战</td>
                        <td style="text-align: center;">28天</td>
                        <td style="text-align: center;">2024-10-03</td>
                        <td style="text-align: right; font-weight: 500;">16,240</td>
                        <td style="text-align: right;">1.30%</td>
                        <td style="text-align: right;">580</td>
                        <td style="text-align: right;">0.05%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 12.3%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">AI图像识别应用</td>
                        <td style="text-align: center;">25天</td>
                        <td style="text-align: center;">2024-10-06</td>
                        <td style="text-align: right; font-weight: 500;">14,780</td>
                        <td style="text-align: right;">1.19%</td>
                        <td style="text-align: right;">591</td>
                        <td style="text-align: right;">0.05%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 4.2%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">微服务架构搭建</td>
                        <td style="text-align: center;">22天</td>
                        <td style="text-align: center;">2024-10-09</td>
                        <td style="text-align: right; font-weight: 500;">13,450</td>
                        <td style="text-align: right;">1.08%</td>
                        <td style="text-align: right;">611</td>
                        <td style="text-align: right;">0.05%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 22.7%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">容器化部署实践</td>
                        <td style="text-align: center;">27天</td>
                        <td style="text-align: center;">2024-10-04</td>
                        <td style="text-align: right; font-weight: 500;">12,890</td>
                        <td style="text-align: right;">1.03%</td>
                        <td style="text-align: right;">477</td>
                        <td style="text-align: right;">0.04%</td>
                        <td style="text-align: right; color: #27ae60; font-weight: 500;">↑ 8.9%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 500;">大数据分析平台</td>
                        <td style="text-align: center;">20天</td>
                        <td style="text-align: center;">2024-10-11</td>
                        <td style="text-align: right; font-weight: 500;">11,320</td>
                        <td style="text-align: right;">0.91%</td>
                        <td style="text-align: right;">566</td>
                        <td style="text-align: right;">0.05%</td>
                        <td style="text-align: right; color: #e74c3c; font-weight: 500;">↓ 6.5%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 5-3 推荐实验点击量分布趋势 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">推荐实验点击量分布趋势</div>
                <div class="chart-subtitle">折线图：展示各实验随时间变化的趋势</div>
            </div>
            <div class="filter-group">
                <label>指标：</label>
                <select id="labMetricSelect" onchange="updateLabChart()">
                    <option value="clicks">点击量</option>
                    <option value="ctr">点击率(%)</option>
                    <option value="avgClicks">日均点击量</option>
                    <option value="avgCtr">日均点击率(%)</option>
                </select>
                <label>排序：</label>
                <select id="labSortSelect" onchange="updateLabChart()">
                    <option value="desc">降序</option>
                    <option value="asc">升序</option>
                </select>
                <label>日期：</label>
                <input type="date" id="labChartStartDate" onchange="updateLabChart()" />
                <span>—</span>
                <input type="date" id="labChartEndDate" onchange="updateLabChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="labChart"></canvas>
        </div>
    </div>
    
    <!-- 模块6: 首页认证考试分析 -->
    <div class="section-title">首页认证考试分析</div>
    
    <!-- 6-1 首页认证基本数据 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">首页认证数据趋势</div>
                <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
            </div>
            <div class="filter-group">
                <label>指标类型：</label>
                <select id="certTypeSelect" onchange="updateCertTrendChart()">
                    <option value="card">认证卡片</option>
                    <option value="overview">查看全部</option>
                </select>
                <label>数据维度：</label>
                <select id="certDataSelect" onchange="updateCertTrendChart()">
                    <option value="clicks">点击量</option>
                    <option value="rate">点击率(%)</option>
                </select>
                <label>对比：</label>
                <select id="certCompareSelect" onchange="updateCertTrendChart()">
                    <option value="yoy">同比</option>
                    <option value="mom">环比</option>
                </select>
                <label>日期：</label>
                <input type="date" id="certStartDate" onchange="updateCertTrendChart()" />
                <span>—</span>
                <input type="date" id="certEndDate" onchange="updateCertTrendChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="certTrendChart"></canvas>
        </div>
    </div>
    
    <!-- 6-2 认证推荐效果分析 -->
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div class="chart-container" style="flex: 1; max-width: 33.33%;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">推荐认证点击量分布</div>
                    <div class="chart-subtitle">两个认证的点击量占比</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="certPieChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container" style="flex: 2;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">推荐认证点击量占比趋势</div>
                    <div class="chart-subtitle">各认证每日点击量占比变化（堆积100%）</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="certStackChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- 模块7: 首页底部模块分析 -->
    <div class="section-title">首页底部模块分析</div>
    
    <!-- 7-1 视频/海报数据 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">视频/海报数据趋势</div>
                <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
            </div>
            <div class="filter-group">
                <label>指标名称：</label>
                <select id="bottomTypeSelect" onchange="updateBottomTrendChart()">
                    <option value="video">视频点击率</option>
                    <option value="poster">海报点击率</option>
                </select>
                <label>对比：</label>
                <select id="bottomCompareSelect" onchange="updateBottomTrendChart()">
                    <option value="yoy">同比</option>
                    <option value="mom">环比</option>
                </select>
                <label>日期：</label>
                <input type="date" id="bottomStartDate" onchange="updateBottomTrendChart()" />
                <span>—</span>
                <input type="date" id="bottomEndDate" onchange="updateBottomTrendChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="bottomTrendChart"></canvas>
        </div>
    </div>
    
    <!-- 模块8: 全局导航栏分析 -->
    <div class="section-title">全局导航栏分析</div>
    
    <!-- 8-1 导航使用情况 -->
    <div class="chart-container full-width">
        <div class="chart-header">
            <div>
                <div class="chart-title">导航使用情况趋势</div>
                <div class="chart-subtitle">双轴柱线图：柱状图展示所选指标，折线图展示同比/环比</div>
            </div>
            <div class="filter-group">
                <label>指标类型：</label>
                <select id="navTypeSelect" onchange="updateNavTrendChart()">
                    <option value="course">在线课程导航</option>
                    <option value="lab">动手实验导航</option>
                    <option value="cert">认证考试导航</option>
                    <option value="training">企业培训导航</option>
                </select>
                <label>数据维度：</label>
                <select id="navDataSelect" onchange="updateNavTrendChart()">
                    <option value="clicks">点击量</option>
                    <option value="rate">点击率(%)</option>
                </select>
                <label>对比：</label>
                <select id="navCompareSelect" onchange="updateNavTrendChart()">
                    <option value="yoy">同比</option>
                    <option value="mom">环比</option>
                </select>
                <label>日期：</label>
                <input type="date" id="navStartDate" onchange="updateNavTrendChart()" />
                <span>—</span>
                <input type="date" id="navEndDate" onchange="updateNavTrendChart()" />
            </div>
        </div>
        <div class="chart-wrapper">
            <canvas id="navTrendChart"></canvas>
        </div>
    </div>
    
    <!-- 8-2 导航点击占比 -->
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div class="chart-container" style="flex: 1; max-width: 33.33%;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">导航点击量分布</div>
                    <div class="chart-subtitle">4个导航入口的点击量占比</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="navPieChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container" style="flex: 2;">
            <div class="chart-header">
                <div>
                    <div class="chart-title">导航点击量分布趋势</div>
                    <div class="chart-subtitle">各导航入口每日点击量占比变化（堆积100%）</div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="navStackChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // 生成日期数据
        function generateDates(days) {
            const dates = [];
            const today = new Date();
            for (let i = days - 1; i >= 0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                dates.push((d.getMonth() + 1) + '/' + d.getDate());
            }
            return dates;
        }
        
        // 生成随机数据
        function generateData(base, variance, length) {
            return Array.from({length}, () => 
                Math.floor(base + (Math.random() - 0.5) * variance)
            );
        }
        
        const dates = generateDates(30);
        const dateObjs = generateDateObjects(30);

        function generateDateObjects(days) {
            const arr = [];
            const today = new Date();
            for (let i = days - 1; i >= 0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                d.setHours(0,0,0,0);
                arr.push(d);
            }
            return arr;
        }

        function formatISO(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function getRangeIndices(startISO, endISO) {
            const start = startISO ? new Date(startISO) : null;
            const end = endISO ? new Date(endISO) : null;
            let startIdx = 0;
            let endIdx = dateObjs.length - 1;
            if (start) {
                for (let i = 0; i < dateObjs.length; i++) {
                    if (dateObjs[i] >= start) { startIdx = i; break; }
                }
            }
            if (end) {
                for (let i = dateObjs.length - 1; i >= 0; i--) {
                    if (dateObjs[i] <= end) { endIdx = i; break; }
                }
            }
            if (startIdx > endIdx) { startIdx = 0; endIdx = dateObjs.length - 1; }
            return { startIdx, endIdx };
        }
        
        // 流量趋势数据
        const trendData = { 
            pv: {
                current: generateData(42000, 8000, 30),
                compare: Array.from({length: 30}, () => (Math.random() * 30 - 5).toFixed(1))
            },
            uv: {
                current: generateData(28000, 5000, 30),
                compare: Array.from({length: 30}, () => (Math.random() * 25 - 3).toFixed(1))
            },
            avg: {
                current: Array.from({length: 30}, () => (1.3 + Math.random() * 0.4).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 20 - 5).toFixed(1))
            },
            bounce: {
                current: Array.from({length: 30}, () => (28 + Math.random() * 10).toFixed(1)),
                compare: Array.from({length: 30}, () => (Math.random() * 15 - 7).toFixed(1))
            }
        };
        
        // 流量趋势图
        let trendChart = new Chart(document.getElementById('trendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '首页访问总量（PV）',
                    data: trendData.pv.current,
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: trendData.pv.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '数值'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateTrendChart() {
            const metric = document.getElementById('trendMetricSelect').value;
            const compare = document.getElementById('trendCompareSelect').value;
            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';
            const start = document.getElementById('trendStartDate')?.value;
            const end = document.getElementById('trendEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const labels = {
                pv: '首页访问总量（PV）',
                uv: '用户数（UV）',
                avg: '人均访问首页数',
                bounce: '首页跳出率(%)'
            };

            trendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            trendChart.data.datasets[0].label = labels[metric];
            trendChart.data.datasets[0].data = trendData[metric].current.slice(startIdx, endIdx + 1);
            trendChart.data.datasets[1].label = compareLabel;
            trendChart.data.datasets[1].data = trendData[metric].compare.slice(startIdx, endIdx + 1);
            trendChart.update();
        }
        
        // Banner数据
        const bannerData = [
            { name: 'AI大模型应用实战', color: 'rgba(231, 76, 60, 1)' },
            { name: '云计算架构设计', color: 'rgba(52, 152, 219, 1)' },
            { name: 'Python数据分析', color: 'rgba(46, 204, 113, 1)' },
            { name: 'Docker容器化技术', color: 'rgba(155, 89, 182, 1)' },
            { name: '前端框架Vue3实战', color: 'rgba(241, 196, 15, 1)' },
            { name: 'Kubernetes实战', color: 'rgba(230, 126, 34, 1)' }
        ];
        
        // 为每个Banner生成时间序列数据
        bannerData.forEach((banner, index) => {
            const baseClicks = [45230, 38950, 32180, 28760, 24390, 19820][index];
            banner.clicks = dates.map(() => Math.floor(baseClicks / 30 * (0.8 + Math.random() * 0.4)));
            banner.ctr = banner.clicks.map(c => (c / 42000 * 100).toFixed(2));
            banner.avgClicks = banner.clicks.map(c => Math.floor(c / 1));
            banner.avgCtr = banner.ctr.map(r => (r / 1).toFixed(3));
        });
        
        // Banner趋势图
        let bannerChart = new Chart(document.getElementById('bannerChart'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: bannerData.map(banner => ({
                    label: banner.name,
                    data: banner.clicks,
                    borderColor: banner.color,
                    backgroundColor: banner.color.replace('1)', '0.1)'),
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 3,
                    pointHoverRadius: 5
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '点击量'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });
        
        function updateBannerChart() {
            const metric = document.getElementById('bannerMetricSelect').value;
            const start = document.getElementById('bannerStartDate')?.value;
            const end = document.getElementById('bannerEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);
            
            const metricLabels = {
                clicks: '点击量',
                ctr: '点击率(%)',
                avgClicks: '日均点击量',
                avgCtr: '日均点击率(%)'
            };
            
            bannerChart.data.labels = dates.slice(startIdx, endIdx + 1);
            bannerChart.data.datasets = bannerData.map(banner => ({
                label: banner.name,
                data: banner[metric].slice(startIdx, endIdx + 1),
                borderColor: banner.color,
                backgroundColor: banner.color.replace('1)', '0.1)'),
                borderWidth: 2,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 5
            }));
            
            bannerChart.options.scales.y.title.text = metricLabels[metric];
            bannerChart.update();
        }
        
        // ========== 模块4: 在线课程数据 ==========
        
        // 课程趋势数据
        const courseTrendData = {
            viewAll: {
                clicks: generateData(2800, 600, 30),
                rate: Array.from({length: 30}, () => (6.5 + Math.random() * 1.5).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 25 - 5).toFixed(1))
            },
            operation: {
                clicks: generateData(4100, 800, 30),
                rate: Array.from({length: 30}, () => (9.5 + Math.random() * 2).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 20 - 3).toFixed(1))
            }
        };
        
        // 课程趋势图
        let courseTrendChart = new Chart(document.getElementById('courseTrendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '查看全部点击量',
                    data: courseTrendData.viewAll.clicks,
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: courseTrendData.viewAll.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '数值'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateCourseTrendChart() {
            const type = document.getElementById('courseTypeSelect').value;
            const data = document.getElementById('courseDataSelect').value;
            const compare = document.getElementById('courseCompareSelect').value;
            const start = document.getElementById('courseStartDate')?.value;
            const end = document.getElementById('courseEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const typeLabels = {
                viewAll: '查看全部',
                operation: '运营位课程'
            };

            const dataLabels = {
                clicks: '点击量',
                rate: '点击率(%)'
            };

            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';

            courseTrendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            courseTrendChart.data.datasets[0].label = typeLabels[type] + dataLabels[data];
            courseTrendChart.data.datasets[0].data = (data === 'clicks' ? courseTrendData[type].clicks : courseTrendData[type].rate).slice(startIdx, endIdx + 1);
            courseTrendChart.data.datasets[1].label = compareLabel;
            courseTrendChart.data.datasets[1].data = courseTrendData[type].compare.slice(startIdx, endIdx + 1);
            courseTrendChart.update();
        }
        
        // 课程Tab数据
        const courseTabNames = ['大咖分享', '产品攻略', '通用技术', '认证备考', '应用实战', '行业案例'];
        const courseTabColors = [
            'rgba(231, 76, 60, 0.8)',
            'rgba(52, 152, 219, 0.8)',
            'rgba(46, 204, 113, 0.8)',
            'rgba(155, 89, 182, 0.8)',
            'rgba(241, 196, 15, 0.8)',
            'rgba(230, 126, 34, 0.8)'
        ];
        const courseTabClicks = [18500, 22300, 19800, 15600, 24200, 20100];
        
        // 课程Tab饼图
        new Chart(document.getElementById('courseTabPieChart'), {
            type: 'pie',
            data: {
                labels: courseTabNames,
                datasets: [{
                    data: courseTabClicks,
                    backgroundColor: courseTabColors,
                    borderColor: courseTabColors.map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });
        
        // 课程Tab堆积图
        const courseTabDailyData = {};
        dates.forEach(date => {
            courseTabDailyData[date] = {};
            courseTabNames.forEach((tab, index) => {
                const baseValue = courseTabClicks[index] / 30;
                courseTabDailyData[date][tab] = Math.floor(baseValue * (0.8 + Math.random() * 0.4));
            });
        });
        
        new Chart(document.getElementById('courseTabStackChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: courseTabNames.map((tab, index) => ({
                    label: tab,
                    data: dates.map(date => {
                        const total = Object.values(courseTabDailyData[date]).reduce((a, b) => a + b, 0);
                        return ((courseTabDailyData[date][tab] / total) * 100).toFixed(1);
                    }),
                    backgroundColor: courseTabColors[index],
                    borderColor: courseTabColors[index].replace('0.8', '1'),
                    borderWidth: 1
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        max: 100,
                        title: {
                            display: true,
                            text: '占比(%)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });
        
        // 课程数据
        const courseData = [
            { name: 'Python数据分析实战', color: 'rgba(231, 76, 60, 1)' },
            { name: 'AI大模型应用开发', color: 'rgba(52, 152, 219, 1)' },
            { name: '云计算架构设计', color: 'rgba(46, 204, 113, 1)' },
            { name: '前端框架Vue3实战', color: 'rgba(155, 89, 182, 1)' },
            { name: 'MySQL性能优化', color: 'rgba(241, 196, 15, 1)' },
            { name: 'Docker容器化技术', color: 'rgba(230, 126, 34, 1)' },
            { name: 'React Native移动开发', color: 'rgba(149, 165, 166, 1)' },
            { name: 'Kubernetes实战指南', color: 'rgba(52, 73, 94, 1)' }
        ];
        
        courseData.forEach((course, index) => {
            const baseClicks = [35680, 32450, 28930, 26780, 24560, 21890, 19340, 17620][index];
            course.clicks = dates.map(() => Math.floor(baseClicks / 30 * (0.8 + Math.random() * 0.4)));
            course.ctr = course.clicks.map(c => (c / 42000 * 100).toFixed(2));
            course.avgClicks = course.clicks.map(c => Math.floor(c / 1));
            course.avgCtr = course.ctr.map(r => (r / 1).toFixed(3));
        });
        
        let courseChart = new Chart(document.getElementById('courseChart'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: courseData.map(course => ({
                    label: course.name,
                    data: course.clicks,
                    borderColor: course.color,
                    backgroundColor: course.color.replace('1)', '0.1)'),
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 3,
                    pointHoverRadius: 5
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '点击量'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });
        
        function updateCourseChart() {
            const metric = document.getElementById('courseMetricSelect').value;
            const sort = document.getElementById('courseSortSelect').value;
            const start = document.getElementById('courseChartStartDate')?.value;
            const end = document.getElementById('courseChartEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const metricLabels = {
                clicks: '点击量',
                ctr: '点击率(%)',
                avgClicks: '日均点击量',
                avgCtr: '日均点击率(%)'
            };

            const sortedCourses = [...courseData].sort((a, b) => {
                const sliceA = a[metric].slice(startIdx, endIdx + 1).map(v => parseFloat(v));
                const sliceB = b[metric].slice(startIdx, endIdx + 1).map(v => parseFloat(v));
                const avgA = sliceA.reduce((s, v) => s + v, 0) / sliceA.length;
                const avgB = sliceB.reduce((s, v) => s + v, 0) / sliceB.length;
                return sort === 'desc' ? avgB - avgA : avgA - avgB;
            });

            courseChart.data.labels = dates.slice(startIdx, endIdx + 1);
            courseChart.data.datasets = sortedCourses.map(course => ({
                label: course.name,
                data: course[metric].slice(startIdx, endIdx + 1),
                borderColor: course.color,
                backgroundColor: course.color.replace('1)', '0.1)'),
                borderWidth: 2,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 5
            }));

            courseChart.options.scales.y.title.text = metricLabels[metric];
            courseChart.update();
        }
        
        // ========== 模块5: 动手实验数据 ==========
        
        // 实验趋势数据
        const labTrendData = {
            clicks: generateData(1750, 400, 30),
            rate: Array.from({length: 30}, () => (4.0 + Math.random() * 1.2).toFixed(2)),
            compare: Array.from({length: 30}, () => (Math.random() * 30 - 8).toFixed(1))
        };
        
        let labTrendChart = new Chart(document.getElementById('labTrendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '查看全部点击量',
                    data: labTrendData.clicks,
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: labTrendData.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '数值'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateLabTrendChart() {
            const data = document.getElementById('labDataSelect').value;
            const compare = document.getElementById('labCompareSelect').value;
            const start = document.getElementById('labStartDate')?.value;
            const end = document.getElementById('labEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const dataLabels = {
                clicks: '查看全部点击量',
                rate: '查看全部转化率(%)'
            };

            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';

            labTrendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            labTrendChart.data.datasets[0].label = dataLabels[data];
            labTrendChart.data.datasets[0].data = labTrendData[data].slice(startIdx, endIdx + 1);
            labTrendChart.data.datasets[1].label = compareLabel;
            labTrendChart.data.datasets[1].data = labTrendData.compare.slice(startIdx, endIdx + 1);
            labTrendChart.update();
        }
        
        // 实验Tab数据
        const labTabNames = ['云服务体验', '技术学习', '综合搭建'];
        const labTabColors = [
            'rgba(52, 152, 219, 0.8)',
            'rgba(46, 204, 113, 0.8)',
            'rgba(155, 89, 182, 0.8)'
        ];
        const labTabClicks = [24500, 18300, 15200];
        
        new Chart(document.getElementById('labTabPieChart'), {
            type: 'pie',
            data: {
                labels: labTabNames,
                datasets: [{
                    data: labTabClicks,
                    backgroundColor: labTabColors,
                    borderColor: labTabColors.map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        const labTabDailyData = {};
        dates.forEach(date => {
            labTabDailyData[date] = {};
            labTabNames.forEach((tab, index) => {
                const baseValue = labTabClicks[index] / 30;
                labTabDailyData[date][tab] = Math.floor(baseValue * (0.8 + Math.random() * 0.4));
            });
        });
        
        new Chart(document.getElementById('labTabStackChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: labTabNames.map((tab, index) => ({
                    label: tab,
                    data: dates.map(date => {
                        const total = Object.values(labTabDailyData[date]).reduce((a, b) => a + b, 0);
                        return ((labTabDailyData[date][tab] / total) * 100).toFixed(1);
                    }),
                    backgroundColor: labTabColors[index],
                    borderColor: labTabColors[index].replace('0.8', '1'),
                    borderWidth: 1
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        max: 100,
                        title: {
                            display: true,
                            text: '占比(%)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        // 实验数据
        const labData = [
            { name: '搭建个人博客网站', color: 'rgba(231, 76, 60, 1)' },
            { name: '云数据库部署实战', color: 'rgba(52, 152, 219, 1)' },
            { name: 'AI图像识别应用', color: 'rgba(46, 204, 113, 1)' },
            { name: '微服务架构搭建', color: 'rgba(155, 89, 182, 1)' },
            { name: '容器化部署实践', color: 'rgba(241, 196, 15, 1)' },
            { name: '大数据分析平台', color: 'rgba(230, 126, 34, 1)' }
        ];
        
        labData.forEach((lab, index) => {
            const baseClicks = [18560, 16240, 14780, 13450, 12890, 11320][index];
            lab.clicks = dates.map(() => Math.floor(baseClicks / 30 * (0.8 + Math.random() * 0.4)));
            lab.ctr = lab.clicks.map(c => (c / 42000 * 100).toFixed(2));
            lab.avgClicks = lab.clicks.map(c => Math.floor(c / 1));
            lab.avgCtr = lab.ctr.map(r => (r / 1).toFixed(3));
        });
        
        let labChart = new Chart(document.getElementById('labChart'), {
            type: 'line',
            data: {
                labels: dates,
                datasets: labData.map(lab => ({
                    label: lab.name,
                    data: lab.clicks,
                    borderColor: lab.color,
                    backgroundColor: lab.color.replace('1)', '0.1)'),
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 3,
                    pointHoverRadius: 5
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '点击量'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });
        
        function updateLabChart() {
            const metric = document.getElementById('labMetricSelect').value;
            const sort = document.getElementById('labSortSelect').value;
            const start = document.getElementById('labChartStartDate')?.value;
            const end = document.getElementById('labChartEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const metricLabels = {
                clicks: '点击量',
                ctr: '点击率(%)',
                avgClicks: '日均点击量',
                avgCtr: '日均点击率(%)'
            };

            const sortedLabs = [...labData].sort((a, b) => {
                const sliceA = a[metric].slice(startIdx, endIdx + 1).map(v => parseFloat(v));
                const sliceB = b[metric].slice(startIdx, endIdx + 1).map(v => parseFloat(v));
                const avgA = sliceA.reduce((s, v) => s + v, 0) / sliceA.length;
                const avgB = sliceB.reduce((s, v) => s + v, 0) / sliceB.length;
                return sort === 'desc' ? avgB - avgA : avgA - avgB;
            });

            labChart.data.labels = dates.slice(startIdx, endIdx + 1);
            labChart.data.datasets = sortedLabs.map(lab => ({
                label: lab.name,
                data: lab[metric].slice(startIdx, endIdx + 1),
                borderColor: lab.color,
                backgroundColor: lab.color.replace('1)', '0.1)'),
                borderWidth: 2,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 5
            }));

            labChart.options.scales.y.title.text = metricLabels[metric];
            labChart.update();
        }
        
        // ========== 模块6: 认证考试数据 ==========
        
        // 认证趋势数据
        const certTrendData = {
            card: {
                clicks: generateData(3200, 650, 30),
                rate: Array.from({length: 30}, () => (2.5 + Math.random() * 0.8).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 28 - 6).toFixed(1))
            },
            overview: {
                clicks: generateData(2100, 450, 30),
                rate: Array.from({length: 30}, () => (1.6 + Math.random() * 0.6).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 25 - 4).toFixed(1))
            }
        };
        
        let certTrendChart = new Chart(document.getElementById('certTrendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '认证卡片点击量',
                    data: certTrendData.card.clicks,
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: certTrendData.card.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '数值'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateCertTrendChart() {
            const type = document.getElementById('certTypeSelect').value;
            const data = document.getElementById('certDataSelect').value;
            const compare = document.getElementById('certCompareSelect').value;
            const start = document.getElementById('certStartDate')?.value;
            const end = document.getElementById('certEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const typeLabels = {
                card: '认证卡片点击',
                overview: '查看全部'
            };

            const dataLabels = {
                clicks: '量',
                rate: '率(%)'
            };

            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';

            certTrendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            certTrendChart.data.datasets[0].label = typeLabels[type] + dataLabels[data];
            certTrendChart.data.datasets[0].data = (data === 'clicks' ? certTrendData[type].clicks : certTrendData[type].rate).slice(startIdx, endIdx + 1);
            certTrendChart.data.datasets[1].label = compareLabel;
            certTrendChart.data.datasets[1].data = certTrendData[type].compare.slice(startIdx, endIdx + 1);
            certTrendChart.update();
        }
        
        // 认证数据
        const certNames = ['云从业者认证', '人工智能工程师认证'];
        const certColors = [
            'rgba(52, 152, 219, 0.8)',
            'rgba(46, 204, 113, 0.8)'
        ];
        const certClicks = [28500, 24300];
        
        new Chart(document.getElementById('certPieChart'), {
            type: 'pie',
            data: {
                labels: certNames,
                datasets: [{
                    data: certClicks,
                    backgroundColor: certColors,
                    borderColor: certColors.map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
        
        const certDailyData = {};
        dates.forEach(date => {
            certDailyData[date] = {};
            certNames.forEach((cert, index) => {
                const baseValue = certClicks[index] / 30;
                certDailyData[date][cert] = Math.floor(baseValue * (0.8 + Math.random() * 0.4));
            });
        });
        
        new Chart(document.getElementById('certStackChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: certNames.map((cert, index) => ({
                    label: cert,
                    data: dates.map(date => {
                        const total = Object.values(certDailyData[date]).reduce((a, b) => a + b, 0);
                        return ((certDailyData[date][cert] / total) * 100).toFixed(1);
                    }),
                    backgroundColor: certColors[index],
                    borderColor: certColors[index].replace('0.8', '1'),
                    borderWidth: 1
                }))
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        max: 100,
                        title: {
                            display: true,
                            text: '占比(%)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        
        // ========== 模块7: 底部模块数据 ==========
        
        const bottomTrendData = {
            video: {
                rate: Array.from({length: 30}, () => (7.5 + Math.random() * 2).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 25 - 5).toFixed(1))
            },
            poster: {
                rate: Array.from({length: 30}, () => (2.8 + Math.random() * 0.8).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 28 - 6).toFixed(1))
            }
        };
        
        let bottomTrendChart = new Chart(document.getElementById('bottomTrendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '视频点击率(%)',
                    data: bottomTrendData.video.rate,
                    backgroundColor: 'rgba(155, 89, 182, 0.6)',
                    borderColor: 'rgba(155, 89, 182, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: bottomTrendData.video.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '点击率(%)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateBottomTrendChart() {
            const type = document.getElementById('bottomTypeSelect').value;
            const compare = document.getElementById('bottomCompareSelect').value;
            const start = document.getElementById('bottomStartDate')?.value;
            const end = document.getElementById('bottomEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const typeLabels = {
                video: '视频点击率(%)',
                poster: '海报点击率(%)'
            };

            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';

            bottomTrendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            bottomTrendChart.data.datasets[0].label = typeLabels[type];
            bottomTrendChart.data.datasets[0].data = bottomTrendData[type].rate.slice(startIdx, endIdx + 1);
            bottomTrendChart.data.datasets[1].label = compareLabel;
            bottomTrendChart.data.datasets[1].data = bottomTrendData[type].compare.slice(startIdx, endIdx + 1);
            bottomTrendChart.update();
        }
        
        // ========== 模块8: 全局导航栏数据 ==========
        
        const navTrendData = {
            course: {
                clicks: generateData(5200, 950, 30),
                rate: Array.from({length: 30}, () => (4.0 + Math.random() * 1.2).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 26 - 5).toFixed(1))
            },
            lab: {
                clicks: generateData(3800, 720, 30),
                rate: Array.from({length: 30}, () => (3.0 + Math.random() * 0.9).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 24 - 4).toFixed(1))
            },
            cert: {
                clicks: generateData(2900, 550, 30),
                rate: Array.from({length: 30}, () => (2.3 + Math.random() * 0.7).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 28 - 6).toFixed(1))
            },
            training: {
                clicks: generateData(1650, 380, 30),
                rate: Array.from({length: 30}, () => (1.3 + Math.random() * 0.5).toFixed(2)),
                compare: Array.from({length: 30}, () => (Math.random() * 30 - 8).toFixed(1))
            }
        };
        
        let navTrendChart = new Chart(document.getElementById('navTrendChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: '在线课程导航点击量',
                    data: navTrendData.course.clicks,
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: '同比变化(%)',
                    data: navTrendData.course.compare,
                    type: 'line',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderWidth: 2,
                    yAxisID: 'y1',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: {
                            display: true,
                            text: '数值'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: {
                            display: true,
                            text: '变化率(%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        function updateNavTrendChart() {
            const type = document.getElementById('navTypeSelect').value;
            const data = document.getElementById('navDataSelect').value;
            const compare = document.getElementById('navCompareSelect').value;
            const start = document.getElementById('navStartDate')?.value;
            const end = document.getElementById('navEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const typeLabels = {
                course: '在线课程导航',
                lab: '动手实验导航',
                cert: '认证考试导航',
                training: '企业培训导航'
            };

            const dataLabels = {
                clicks: '点击量',
                rate: '点击率(%)'
            };

            const compareLabel = compare === 'yoy' ? '同比变化(%)' : '环比变化(%)';

            navTrendChart.data.labels = dates.slice(startIdx, endIdx + 1);
            navTrendChart.data.datasets[0].label = typeLabels[type] + dataLabels[data];
            navTrendChart.data.datasets[0].data = (data === 'clicks' ? navTrendData[type].clicks : navTrendData[type].rate).slice(startIdx, endIdx + 1);
            navTrendChart.data.datasets[1].label = compareLabel;
            navTrendChart.data.datasets[1].data = navTrendData[type].compare.slice(startIdx, endIdx + 1);
            navTrendChart.update();
        }
        
        const navNames = ['在线课程', '动手实验', '认证考试', '企业培训'];
        const navColors = [
            'rgba(52, 152, 219, 0.8)',
            'rgba(46, 204, 113, 0.8)',
            'rgba(155, 89, 182, 0.8)',
            'rgba(241, 196, 15, 0.8)'
        ];
        
        const navClicks = [
            navTrendData.course.clicks.reduce((a, b) => a + b, 0),
            navTrendData.lab.clicks.reduce((a, b) => a + b, 0),
            navTrendData.cert.clicks.reduce((a, b) => a + b, 0),
            navTrendData.training.clicks.reduce((a, b) => a + b, 0)
        ];
        
        new Chart(document.getElementById('navPieChart'), {
            type: 'pie',
            data: {
                labels: navNames,
                datasets: [{
                    data: navClicks,
                    backgroundColor: navColors,
                    borderColor: navColors.map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return context.label + ': ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
        
        new Chart(document.getElementById('navStackChart'), {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: '在线课程',
                        data: dates.map((date, index) => {
                            const total = navTrendData.course.clicks[index] + 
                                        navTrendData.lab.clicks[index] + 
                                        navTrendData.cert.clicks[index] + 
                                        navTrendData.training.clicks[index];
                            return ((navTrendData.course.clicks[index] / total) * 100).toFixed(1);
                        }),
                        backgroundColor: navColors[0],
                        borderColor: navColors[0].replace('0.8', '1'),
                        borderWidth: 1
                    },
                    {
                        label: '动手实验',
                        data: dates.map((date, index) => {
                            const total = navTrendData.course.clicks[index] + 
                                        navTrendData.lab.clicks[index] + 
                                        navTrendData.cert.clicks[index] + 
                                        navTrendData.training.clicks[index];
                            return ((navTrendData.lab.clicks[index] / total) * 100).toFixed(1);
                        }),
                        backgroundColor: navColors[1],
                        borderColor: navColors[1].replace('0.8', '1'),
                        borderWidth: 1
                    },
                    {
                        label: '认证考试',
                        data: dates.map((date, index) => {
                            const total = navTrendData.course.clicks[index] + 
                                        navTrendData.lab.clicks[index] + 
                                        navTrendData.cert.clicks[index] + 
                                        navTrendData.training.clicks[index];
                            return ((navTrendData.cert.clicks[index] / total) * 100).toFixed(1);
                        }),
                        backgroundColor: navColors[2],
                        borderColor: navColors[2].replace('0.8', '1'),
                        borderWidth: 1
                    },
                    {
                        label: '企业培训',
                        data: dates.map((date, index) => {
                            const total = navTrendData.course.clicks[index] + 
                                        navTrendData.lab.clicks[index] + 
                                        navTrendData.cert.clicks[index] + 
                                        navTrendData.training.clicks[index];
                            return ((navTrendData.training.clicks[index] / total) * 100).toFixed(1);
                        }),
                        backgroundColor: navColors[3],
                        borderColor: navColors[3].replace('0.8', '1'),
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        max: 100,
                        title: {
                            display: true,
                            text: '占比(%)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    }
                }
            }
        });

        // 更新首页核心指标根据所选日期区间
        function updateCoreMetrics() {
            const start = document.getElementById('coreStartDate')?.value;
            const end = document.getElementById('coreEndDate')?.value;
            const { startIdx, endIdx } = getRangeIndices(start, end);

            const pv = trendData.pv.current.slice(startIdx, endIdx + 1).reduce((s, v) => s + Number(v), 0);
            const uv = trendData.uv.current.slice(startIdx, endIdx + 1).reduce((s, v) => s + Number(v), 0);
            const avgArr = trendData.avg.current.slice(startIdx, endIdx + 1).map(v => Number(v));
            const avg = (avgArr.reduce((s, v) => s + v, 0) / avgArr.length).toFixed(2);
            const bounceArr = trendData.bounce.current.slice(startIdx, endIdx + 1).map(v => Number(v));
            const bounce = (bounceArr.reduce((s, v) => s + v, 0) / bounceArr.length).toFixed(1);

            document.getElementById('corePV').textContent = pv.toLocaleString();
            document.getElementById('coreUV').textContent = uv.toLocaleString();
            document.getElementById('coreAvg').textContent = avg;
            document.getElementById('coreBounce').textContent = bounce + '%';
        }

        // 初始化日期控件与默认值（核心指标默认昨日，其他模块默认MTD）
        (function initDateFilters(){
            const minISO = formatISO(dateObjs[0]);
            const maxISO = formatISO(dateObjs[dateObjs.length-1]);

            const allDateInputs = document.querySelectorAll('.filter-group input[type="date"]');
            allDateInputs.forEach(inp=> { inp.min = minISO; inp.max = maxISO; });

            const today = dateObjs[dateObjs.length-1];
            const monthFirst = new Date(today.getFullYear(), today.getMonth(), 1);
            const mtdStart = monthFirst < dateObjs[0] ? dateObjs[0] : monthFirst;
            const mtdStartISO = formatISO(mtdStart);
            const todayISO = formatISO(today);

            const mtdIds = ['trendStartDate','trendEndDate','bannerStartDate','bannerEndDate','courseStartDate','courseEndDate','courseChartStartDate','courseChartEndDate','labStartDate','labEndDate','labChartStartDate','labChartEndDate','certStartDate','certEndDate','bottomStartDate','bottomEndDate','navStartDate','navEndDate'];
            mtdIds.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (id.endsWith('StartDate')) el.value = mtdStartISO; else el.value = todayISO;
            });

            // 核心指标默认昨天
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yISO = formatISO(yesterday);
            const coreStart = document.getElementById('coreStartDate');
            const coreEnd = document.getElementById('coreEndDate');
            if (coreStart) { coreStart.min = minISO; coreStart.max = maxISO; coreStart.value = yISO; }
            if (coreEnd) { coreEnd.min = minISO; coreEnd.max = maxISO; coreEnd.value = yISO; }

            // 初始刷新一次所有视图
            updateCoreMetrics();
            updateTrendChart();
            updateBannerChart();
            updateCourseTrendChart();
            updateCourseChart();
            updateLabTrendChart();
            updateLabChart();
            updateCertTrendChart();
            updateBottomTrendChart();
            updateNavTrendChart();
        })();
    </script>
</body>
</html>